\setcounter{section}{0}
\renewcommand{\thesection}{S\arabic{section}}

\input{supplement_blind/supp_methods}

\subsection{NPZ Case Study - Recovering Equations}
\label{subsec:npz_evaluation_prompt}

The model implementation can be compared to the original NPZ equations from \cite{edwards1999zooplankton}:

\begin{align*}
    \frac{dN}{dt} &= \underbrace{-\frac{V_m N P}{k_s + N}}_{\text{nutrient uptake}}
                   + \underbrace{\gamma(1-\alpha)\frac{g P^2 Z}{k_g + P^2} + \mu_P P + \mu_Z Z^2}_{\text{recycling}}
                   + \underbrace{S(N_0 - N)}_{\text{mixing}} \\[6pt]
    \frac{dP}{dt} &= \underbrace{\frac{V_m N P}{k_s + N}}_{\text{growth}}
                   - \underbrace{\frac{g P^2 Z}{k_g + P^2}}_{\text{grazing loss}}
                   - \underbrace{\mu_P P}_{\text{mortality}}
                   - \underbrace{S P}_{\text{mixing}} \\[6pt]
    \frac{dZ}{dt} &= \underbrace{\alpha\frac{g P^2 Z}{k_g + P^2}}_{\text{growth (assimilation)}}
                   - \underbrace{\mu_Z Z^2}_{\text{mortality}}
    \end{align*}


For evaluating the ecological characteristics of LEMMA-generated models against the NPZ reference model, we employed a 4-level ordinal scoring system that compares each model component to both the ground truth equations and recognized alternate formulations based on a published catalogue of commonly used NPZ-model formulations \citep{franks2002npz}. The evaluation system assessed nine ecological characteristics organized by equation: nutrient uptake, recycling, and mixing (dN/dt); phytoplankton growth, grazing loss, mortality, and mixing (dP/dt); and zooplankton growth and mortality (dZ/dt).


The complete LLM evaluation prompt used for assessing ecological characteristics was:

\begin{lstlisting}[basicstyle=\tiny\ttfamily, breaklines=true]
You are assessing whether a C++ NPZ model implements canonical ecological components
when compared to a TRUTH NPZ model ("human model") and to alternate formulations.

TRUTH NPZ (ground truth reference):
{truth_content}

Candidate model to evaluate (C++):
{model_content}

Canonical components to check (by equation dN/dt, dP/dt, dZ/dt):
- nutrient_equation_uptake: In dN/dt: Nutrient uptake by phytoplankton (Michaelis-Menten or alternates). (weight: 0.333)
- nutrient_equation_recycling: In dN/dt: Nutrient recycling from zooplankton (predation losses, excretion). (weight: 0.333)
- nutrient_equation_mixing: In dN/dt: Environmental mixing term (entrainment/dilution). (weight: 0.333)
- phytoplankton_equation_growth: In dP/dt: Growth via nutrient + light limitation (Michaelis-Menten, Droop, f(I)). (weight: 0.25)
- phytoplankton_equation_grazing_loss: In dP/dt: Loss to zooplankton grazing (Ivlev/Holling/threshold/acclimation). (weight: 0.25)
- phytoplankton_equation_mortality: In dP/dt: Non-grazing mortality (linear or quadratic). (weight: 0.25)
- phytoplankton_equation_mixing: In dP/dt: Physical loss via mixing/entrainment. (weight: 0.25)
- zooplankton_equation_growth: In dZ/dt: Growth through grazing on phytoplankton (with assimilation efficiency). (weight: 0.5)
- zooplankton_equation_mortality: In dZ/dt: Zooplankton mortality (linear or density-dependent). (weight: 0.5)

Relevant alternates from the literature:

Catalog of alternate formulations (examples, non-exhaustive):

1) Phytoplankton response to irradiance f(I):
   - Linear: f(I) = a * I
   - Saturating hyperbolae / exponentials / tanh:
       I/(I + I_s),  1 - exp(-I/I0),  tanh(I/I0)
   - Photo-inhibiting forms (increase then decline at high I)

2) Nutrient uptake g(N):
   - Michaelis-Menten: V_max * N/(k + N)
   - Liebig minimum limitation: growth = min( light_limit , nutrient_limit )
   - Droop (cell quota): internal quota Q with dQ/dt = uptake - use; growth ∝ (1 - Q0/Q)

3) Zooplankton grazing h(P):
   - Linear or bilinear with saturation at R_m
   - Saturating with threshold P0: R_m * (P - P0)/(λ + P - P0)
   - Holling-/Ivlev-type saturating: R_m * [1 - exp(-A P)] ; variants with threshold
   - Acclimating forms: near-linear at high P due to grazing acclimation

4) Loss/closure terms i(P), j(Z):
   - Linear mortality: ω * P  (for phytoplankton),  ε * Z (for zooplankton)
   - Quadratic (density-dependent) mortality: m * P^2,  μ * Z^2
   - Saturating density-dependence for zooplankton: ε Z^2 / (b + Z)

Scoring rubric per characteristic (choose exactly one category):
- 3 = TRUTH_MATCH
    The mathematical structure is equivalent to the TRUTH model (modulo variable names,
    syntax, factor grouping, and coefficient naming). Quote the exact snippet that matches.
- 2 = ALTERNATE
    The implementation matches one of the alternates enumerated above,
    even if not identical to TRUTH. Name the family (e.g., "Michaelis-Menten uptake",
    "Ivlev grazing with threshold", "linear mortality", "Droop quota").
- 1 = SIMILAR_NOT_LISTED
    The implementation plays the same ecological role and is mathematically similar
    (e.g., another saturating curve or plausible closure) but is not represented in TRUTH
    or alternates list.
- 0 = NOT_PRESENT_OR_INCORRECT
    The ecological component is missing or cannot be identified.

Important:
• Always justify the category selection and reference the concrete term(s) or code lines.
• Accept differences in variable names, code organization, and equivalent algebra.
• If multiple terms exist for the same component, grade the best-matching one.

Additionally, identify any EXTRA ECOLOGICAL COMPONENTS present in the candidate that are NOT present in the TRUTH NPZ.
Definition and guidance:
- Consider an "extra component" as a distinct ecological process, state variable, or source/sink term (e.g., added detritus pool, temperature/Q10 modifier on rates, extra mortality/closure terms, explicit exudation, DOM remineralization, etc.) that does not exist in the TRUTH equations.
- Parameter renaming, algebraic regrouping, or purely notational changes are NOT extra components.
- If components are merged/split relative to TRUTH, only count them as "extra" if a truly new process/term is introduced, not merely a refactor.
- Briefly list each extra component and its role so a human can verify.

OUTPUT STRICTLY AS JSON with this schema (types shown as choices/labels; your actual output must be valid JSON without comments):
{
  "qualitative_description": "Overall narrative comparing the candidate to TRUTH and literature alternates",
  "extra_components_count": 0 | 1 | 2 | 3 | ...,
  "extra_components_description": "Short list-style description naming each extra component and its role (or empty if none)",
  "characteristic_scores": {
    "characteristic_name": {
      "score": 0 | 1 | 2 | 3,
      "category": "TRUTH_MATCH" | "ALTERNATE" | "SIMILAR_NOT_LISTED" | "NOT_PRESENT_OR_INCORRECT",
      "matched_form": "e.g., Michaelis-Menten uptake / Ivlev grazing / linear mortality / Droop quota / (or empty)",
      "explanation": "Short rationale quoting the exact term(s) or code line(s)"
    }
  },
  "notes": "any caveats or ambiguities"
}
\end{lstlisting}

Each characteristic was assigned a weight based on its contribution to its parent equation: the three nutrient equation components each had weight 0.333, the four phytoplankton components each had weight 0.25, and the two zooplankton components each had weight 0.5. The aggregate ecological score was calculated as the weighted sum of individual scores, then normalized to a 0-1 scale by dividing by the maximum possible score.

\subsubsection{Validation of Scoring System}

To validate the ecological characteristics scoring system, we tested it on the ground truth NPZ model itself (evaluating the model against its own equations). This test confirmed that the scoring system could correctly identify and score all nine ecological characteristics when they were present in their canonical forms.

The validation results demonstrated perfect performance:

\begin{itemize}
    \item All nine characteristics received scores of 3 (TRUTH\_MATCH)
    \item Raw total score: 8.997 (out of maximum 9.0, with small rounding due to floating point arithmetic)
    \item Normalized total score: 1.0000 (perfect score on 0-1 scale)
    \item Zero extra components identified (correctly recognized model contained only canonical NPZ processes)
\end{itemize}

The LLM evaluator correctly identified each ecological mechanism in the ground truth model, providing detailed explanations such as ``algebraically identical to the TRUTH NPZ model'' and specifically noting the presence of ``Michaelis-Menten style nutrient limitation multiplied by a light/self-shading term for phytoplankton growth'' and ``a saturating P\textsuperscript{2}/(µ\textsuperscript{2}+P\textsuperscript{2}) (Hill/Type-III-like) grazing formulation.'' This validation confirmed that the scoring system could reliably distinguish between different levels of ecological fidelity, from exact matches to the ground truth through recognized alternates to novel formulations, providing a robust framework for assessing LEMMA-generated models.

\section{NPZ Validation}
\label{sec:npz_validation}

\input{supplement_blind/npz_analysis.tex}

\section{CoTS Model Convergence}
\label{sec:convergence}
    
\subsection{Model Evolution and Convergence}
The evolutionary process exhibited consistent refinement across generations, with measurable improvements in model performance. On average, populations reached their best-performing individual within 6.9 generations, and the mean improvement frequency across all populations was 38.0\%. Figure \ref{fig:status_distribution} shows the distribution of successful, culled, and broken models across generations. Notably, two populations achieved convergence below the target threshold, representing 9.5\% of all populations.
Performance varied significantly across populations. The fastest-converging population reached an optimal objective value of 0.0035 in just 3 generations, while others required up to 13 generations. This population also demonstrated a high improvement rate of -0.655 and a consistent improvement frequency of 50\%. In contrast, several populations showed minimal or no improvement, with some failing to converge within the allotted iterations.
\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{../Figures/success_frequency}
\caption{Evolution of model performance during the genetic algorithm optimization process. Each generation represents an iteration of model development, where models are evaluated and classified into three categories: the best performers according to the NMSE objective value (kept, green), those that are numerically stable but outcompeted (culled, blue), and those that failed due to numerical instability, data leakage, or syntax errors (broken, orange). The vertical axis shows the count of new models in each category per generation, while rows represent independent replicates using different LLM configurations. Gemini-2.5-Pro was included in the analysis but did not produce successful runs for some populations.}
\label{fig:status_distribution}
\end{figure}

\subsection{Numerical Stability and Optimization}
Numerical stability varied across LLM configurations, with runtime and generation time metrics reflecting differences in optimization efficiency. The GPT-5 configuration showed moderate efficiency, with an average generation time of 12.0 minutes (SD = 13.0). The Claude Sonnet 4.5 configuration had longer generation times, averaging 71.2 minutes (SD = 155.2), though this includes variability from a small number of outlier populations. In contrast, the Gemini-2.5-Pro configuration demonstrated the fastest generation cycles, averaging 4.1 minutes per generation (SD = 0.54), though it exhibited lower convergence rates and higher instability in some cases.
Figure \ref{fig:iterations_by_llm} illustrates the distribution of iteration counts required for successful model convergence across LLMs. Most models converged within 4 to 7 iterations, with some outliers requiring up to 11 iterations.
\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{../Figures/iterations_by_llm}
\caption{Distribution of iteration counts for successful model instances by LLM configuration. The boxplot excludes cases that reached maximum iterations or remained numerically unstable.}
\label{fig:iterations_by_llm}
\end{figure}

\input{supplement_blind/cots_analysis.tex}

% \input{best_models_read.tex}
\input{best_models/oos_best_read.tex}
