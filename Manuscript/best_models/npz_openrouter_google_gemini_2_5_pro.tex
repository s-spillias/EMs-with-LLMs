\subsection{openrouter:google/gemini-2.5-pro Model (NPZ)}
This model achieved an objective value of 0.0357 (Population 16).

\subsubsection{Model Intention}
\begin{lstlisting}
Model Assessment:
The current model is a standard NPZD (Nutrient-Phytoplankton-Zooplankton-Detritus) formulation that captures the core dynamics of a simple plankton ecosystem. Key strengths include the implementation of phytoplankton self-shading and a Holling Type III functional response for zooplankton grazing on phytoplankton, which provides a refuge for phytoplankton at low densities.

The primary simplification identified is the zooplankton diet, which is restricted solely to phytoplankton. This overlooks the common ecological reality that many zooplankton are omnivorous and consume detritus as a supplementary or alternative food source. This missing pathway represents an opportunity to improve the model's representation of carbon flow and food web stability.

Proposed Improvement: Introduce Zooplankton Omnivory

Rationale:
To enhance ecological realism, I will modify the model to include zooplankton omnivory, allowing them to graze on both phytoplankton (P) and detritus (D). This change introduces a crucial ecological interaction, providing a more robust food web structure where zooplankton have an alternative food source when phytoplankton is scarce. This also improves the model's simulation of the role of detritus in the ecosystem's carbon cycle.

Implementation Plan:
1.  A new grazing term will be added to allow zooplankton to feed on detritus. This will be modeled using a Holling Type II functional response (`g_max_D * D / (K_D + D) * Z`), which is suitable for a passive food source like detritus. The existing Holling Type III response for phytoplankton grazing will be retained.
2.  To support this, three new parameters will be introduced in `parameters.json`:
    *   `g_max_D`: Maximum grazing rate on detritus.
    *   `K_D`: Half-saturation constant for detritus grazing.
    *   `beta_D`: Assimilation efficiency for consumed detritus.
3.  For clarity, the existing parameters `g_max` and `beta` will be renamed to `g_max_P` and `beta_P` to explicitly link them to phytoplankton grazing.
4.  The differential equations in `model.cpp` for Nutrient (dN/dt), Zooplankton (dZ/dt), and Detritus (dD/dt) will be updated to reflect this new pathway. Carbon from consumed detritus will be assimilated by zooplankton or returned to the nutrient pool via sloppy feeding, consistent with the model's existing structure.
\end{lstlisting}

\subsubsection{Model Implementation}
\begin{lstlisting}
#include <TMB.hpp>

template<class Type>
Type objective_function<Type>::operator() ()
{
  // ------------------------------------------------------------------------
  // DATA
  // ------------------------------------------------------------------------
  
  // Observed data vectors
  DATA_VECTOR(Time); // Time vector of observations
  DATA_VECTOR(N_dat); // Observed Nutrient concentration (g C m^-3)
  DATA_VECTOR(P_dat); // Observed Phytoplankton concentration (g C m^-3)
  DATA_VECTOR(Z_dat); // Observed Zooplankton concentration (g C m^-3)

  // ------------------------------------------------------------------------
  // PARAMETERS
  // ------------------------------------------------------------------------

  // Phytoplankton growth parameters
  PARAMETER(V_max);   // Maximum phytoplankton uptake rate (day^-1)
  PARAMETER(K_N);     // Half-saturation constant for nutrient uptake (g C m^-3)
  PARAMETER(alpha_shading); // Self-shading coefficient for phytoplankton ((g C m^-3)^-1)

  // Zooplankton grazing parameters
  PARAMETER(g_max_P);   // Maximum grazing rate of zooplankton on phytoplankton (day^-1)
  PARAMETER(K_P);       // Half-saturation constant for grazing on phytoplankton (g C m^-3)
  PARAMETER(beta_P);    // Zooplankton assimilation efficiency from phytoplankton (dimensionless)
  PARAMETER(g_max_D);   // Maximum grazing rate of zooplankton on detritus (day^-1)
  PARAMETER(K_D);       // Half-saturation constant for grazing on detritus (g C m^-3)
  PARAMETER(beta_D);    // Zooplankton assimilation efficiency from detritus (dimensionless)

  // Mortality and regeneration parameters
  PARAMETER(m_P);       // Phytoplankton linear mortality rate (day^-1)
  PARAMETER(m_Z);       // Zooplankton quadratic mortality rate ((g C m^-3)^-1 day^-1)
  PARAMETER(gamma);     // Zooplankton excretion rate (day^-1)
  PARAMETER(epsilon);   // Remineralization rate of detritus (day^-1)
  PARAMETER(w_D);       // Detritus sinking rate (day^-1)

  // Observation error parameters (log scale to ensure positivity)
  PARAMETER(log_sigma_N); // Log standard deviation for Nutrient observations
  PARAMETER(log_sigma_P); // Log standard deviation for Phytoplankton observations
  PARAMETER(log_sigma_Z); // Log standard deviation for Zooplankton observations

  // Transform log standard deviations to natural scale
  Type sigma_N = exp(log_sigma_N);
  Type sigma_P = exp(log_sigma_P);
  Type sigma_Z = exp(log_sigma_Z);

  // ------------------------------------------------------------------------
  // MODEL DEFINITION
  // ------------------------------------------------------------------------

  int n_obs = Time.size(); // Number of observation time points

  // Create vectors to store model predictions
  vector<Type> N_pred(n_obs);
  vector<Type> P_pred(n_obs);
  vector<Type> Z_pred(n_obs);
  vector<Type> D_pred(n_obs); // Detritus state variable

  // Initialize predictions at time 0 with the first data point
  N_pred(0) = N_dat(0);
  P_pred(0) = P_dat(0);
  Z_pred(0) = Z_dat(0);
  D_pred(0) = Type(0.0); // Initialize detritus at zero

  // --- System of Ordinary Differential Equations (ODEs) ---
  // 1. dN/dt = -Uptake + Unassimilated_Grazing + Excretion + Remineralization
  // 2. dP/dt =  Uptake - Grazing_P - P_Mortality
  // 3. dZ/dt =  Assimilated_Grazing - Z_Mortality - Excretion
  // 4. dD/dt =  P_Mortality + Z_Mortality - Grazing_D - Remineralization - Detritus_Sinking

  // Time-stepping loop to solve the ODEs using the Euler method
  for (int i = 1; i < n_obs; ++i) {
    Type dt = Time(i) - Time(i-1); // Time step duration

    // Concentrations from the previous time step
    Type N_prev = N_pred(i-1);
    Type P_prev = P_pred(i-1);
    Type Z_prev = Z_pred(i-1);
    Type D_prev = D_pred(i-1);

    // --- Ecological Process Rates ---
    
    // Nutrient uptake by phytoplankton (Michaelis-Menten with self-shading)
    Type nutrient_limitation = N_prev / (K_N + N_prev + Type(1e-8));
    Type self_shading_limitation = Type(1.0) / (Type(1.0) + alpha_shading * P_prev);
    Type uptake = V_max * nutrient_limitation * self_shading_limitation * P_prev;

    // Grazing of phytoplankton by zooplankton (Holling Type III functional response)
    Type grazing_P = g_max_P * (P_prev * P_prev) / ((K_P * K_P) + (P_prev * P_prev) + Type(1e-8)) * Z_prev;

    // Grazing of detritus by zooplankton (Holling Type II functional response)
    Type grazing_D = g_max_D * D_prev / (K_D + D_prev + Type(1e-8)) * Z_prev;

    // Phytoplankton mortality (linear)
    Type p_mortality = m_P * P_prev;

    // Zooplankton mortality (quadratic, representing predation)
    Type z_mortality = m_Z * Z_prev * Z_prev;

    // Zooplankton excretion/respiration
    Type excretion = gamma * Z_prev;

    // Total grazing assimilated by zooplankton
    Type assimilated_grazing_total = beta_P * grazing_P + beta_D * grazing_D;

    // Total unassimilated grazing (sloppy feeding), recycled to nutrient pool
    Type unassimilated_grazing_total = (Type(1.0) - beta_P) * grazing_P + (Type(1.0) - beta_D) * grazing_D;

    // Remineralization of detritus pool
    Type remineralization = epsilon * D_prev;

    // Sinking of detritus out of the mixed layer
    Type detritus_sinking = w_D * D_prev;

    // --- Update State Variables ---
    
    // Change in Nutrient concentration
    Type dN = -uptake + unassimilated_grazing_total + excretion + remineralization;
    N_pred(i) = N_prev + dN * dt;

    // Change in Phytoplankton concentration
    Type dP = uptake - grazing_P - p_mortality;
    P_pred(i) = P_prev + dP * dt;

    // Change in Zooplankton concentration
    Type dZ = assimilated_grazing_total - z_mortality - excretion;
    Z_pred(i) = Z_prev + dZ * dt;

    // Change in Detritus concentration
    Type dD = p_mortality + z_mortality - remineralization - detritus_sinking - grazing_D;
    D_pred(i) = D_prev + dD * dt;

    // --- Numerical Stability ---
    // Ensure predictions do not fall below a small positive value
    N_pred(i) = CppAD::CondExpGt(N_pred(i), Type(0.0), N_pred(i), Type(1e-8));
    P_pred(i) = CppAD::CondExpGt(P_pred(i), Type(0.0), P_pred(i), Type(1e-8));
    Z_pred(i) = CppAD::CondExpGt(Z_pred(i), Type(0.0), Z_pred(i), Type(1e-8));
    D_pred(i) = CppAD::CondExpGt(D_pred(i), Type(0.0), D_pred(i), Type(1e-8));
  }

  // ------------------------------------------------------------------------
  // LIKELIHOOD CALCULATION
  // ------------------------------------------------------------------------

  Type nll = 0.0; // Initialize negative log-likelihood

  // Loop through all observations to calculate the likelihood
  for (int i = 0; i < n_obs; ++i) {
    // Lognormal distribution is appropriate for strictly positive data like concentrations
    // The 'true' argument specifies that the log-probability is returned
    nll -= dnorm(log(N_dat(i)), log(N_pred(i)), sigma_N, true);
    nll -= dnorm(log(P_dat(i)), log(P_pred(i)), sigma_P, true);
    nll -= dnorm(log(Z_dat(i)), log(Z_pred(i)), sigma_Z, true);
  }

  // ------------------------------------------------------------------------
  // PARAMETER BOUNDS (Smooth Penalties)
  // ------------------------------------------------------------------------
  
  // Penalize parameters that stray outside their biologically plausible ranges.
  // This acts as a "soft" constraint during optimization.
  Type penalty_sd = 0.1;
  if (V_max < 0.0)     { nll -= dnorm(V_max, Type(0.0), penalty_sd, true); }
  if (K_N < 0.0)      { nll -= dnorm(K_N, Type(0.0), penalty_sd, true); }
  if (alpha_shading < 0.0) { nll -= dnorm(alpha_shading, Type(0.0), penalty_sd, true); }
  if (g_max_P < 0.0)     { nll -= dnorm(g_max_P, Type(0.0), penalty_sd, true); }
  if (K_P < 0.0)      { nll -= dnorm(K_P, Type(0.0), penalty_sd, true); }
  if (beta_P < 0.0)     { nll -= dnorm(beta_P, Type(0.0), penalty_sd, true); }
  if (beta_P > 1.0)     { nll -= dnorm(beta_P, Type(1.0), penalty_sd, true); }
  if (g_max_D < 0.0)     { nll -= dnorm(g_max_D, Type(0.0), penalty_sd, true); }
  if (K_D < 0.0)      { nll -= dnorm(K_D, Type(0.0), penalty_sd, true); }
  if (beta_D < 0.0)     { nll -= dnorm(beta_D, Type(0.0), penalty_sd, true); }
  if (beta_D > 1.0)     { nll -= dnorm(beta_D, Type(1.0), penalty_sd, true); }
  if (m_P < 0.0)      { nll -= dnorm(m_P, Type(0.0), penalty_sd, true); }
  if (m_Z < 0.0)      { nll -= dnorm(m_Z, Type(0.0), penalty_sd, true); }
  if (gamma < 0.0)     { nll -= dnorm(gamma, Type(0.0), penalty_sd, true); }
  if (epsilon < 0.0)   { nll -= dnorm(epsilon, Type(0.0), penalty_sd, true); }
  if (w_D < 0.0)       { nll -= dnorm(w_D, Type(0.0), penalty_sd, true); }

  // ------------------------------------------------------------------------
  // REPORTING
  // ------------------------------------------------------------------------

  // Report predicted time series for plotting and evaluation
  REPORT(N_pred);
  REPORT(P_pred);
  REPORT(Z_pred);
  REPORT(D_pred);

  // Report the final negative log-likelihood value
  REPORT(nll);

  // Report predictions for standard error calculation
  ADREPORT(N_pred);
  ADREPORT(P_pred);
  ADREPORT(Z_pred);
  ADREPORT(D_pred);

  return nll;
}
\end{lstlisting}

\subsubsection{Model Parameters}
\begin{lstlisting}
{
    "parameters": [
        {
            "parameter": "Time",
            "value": null,
            "units": "days",
            "description": "Time points of the observations. Corresponds to 'Time (days)' column in data.",
            "source": "data file",
            "import_type": "DATA_VECTOR",
            "priority": null,
            "lower_bound": 0.0,
            "upper_bound": null,
            "enhanced_semantic_description": "Observation time points in days",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "N_dat",
            "value": null,
            "units": "g C m^-3",
            "description": "Observed nutrient concentration.",
            "source": "data file",
            "import_type": "DATA_VECTOR",
            "priority": null,
            "lower_bound": 0.0,
            "upper_bound": null,
            "enhanced_semantic_description": "Measured nutrient concentration in mixed layer (g C/m\u00b3)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "P_dat",
            "value": null,
            "units": "g C m^-3",
            "description": "Observed phytoplankton concentration.",
            "source": "data file",
            "import_type": "DATA_VECTOR",
            "priority": null,
            "lower_bound": 0.0,
            "upper_bound": null,
            "enhanced_semantic_description": "Measured phytoplankton biomass concentration (g C/m\u00b3)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "Z_dat",
            "value": null,
            "units": "g C m^-3",
            "description": "Observed zooplankton concentration.",
            "source": "data file",
            "import_type": "DATA_VECTOR",
            "priority": null,
            "lower_bound": 0.0,
            "upper_bound": null,
            "enhanced_semantic_description": "Measured zooplankton biomass concentration (g C/m\u00b3)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "V_max",
            "value": 1.5,
            "units": "day^-1",
            "description": "Maximum phytoplankton nutrient uptake rate.",
            "source": "literature",
            "import_type": "PARAMETER",
            "priority": 1,
            "lower_bound": 0.0,
            "upper_bound": 10.0,
            "enhanced_semantic_description": "Max phytoplankton nutrient uptake rate (day\u207b\u00b9)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "K_N",
            "value": 0.1,
            "units": "g C m^-3",
            "description": "Half-saturation constant for nutrient uptake by phytoplankton.",
            "source": "literature",
            "import_type": "PARAMETER",
            "priority": 1,
            "lower_bound": 1e-06,
            "upper_bound": 10.0,
            "enhanced_semantic_description": "Half-saturation nutrient conc. for phytoplankton uptake (g C/m\u00b3)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "g_max_P",
            "value": 1.0,
            "units": "day^-1",
            "description": "Maximum grazing rate of zooplankton on phytoplankton.",
            "source": "literature",
            "import_type": "PARAMETER",
            "priority": 1,
            "lower_bound": 0.0,
            "upper_bound": 10.0,
            "enhanced_semantic_description": "Max zooplankton grazing rate on phytoplankton (day\u207b\u00b9)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "K_P",
            "value": 0.2,
            "units": "g C m^-3",
            "description": "Half-saturation constant for zooplankton grazing on phytoplankton, modeled with a Holling Type III functional response.",
            "source": "literature",
            "import_type": "PARAMETER",
            "priority": 1,
            "lower_bound": 1e-06,
            "upper_bound": 10.0,
            "enhanced_semantic_description": "Half-saturation phytoplankton conc. for sigmoidal (Holling Type III) zooplankton grazing (g C/m\u00b3)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "beta_P",
            "value": 0.7,
            "units": "dimensionless",
            "description": "Zooplankton assimilation efficiency from consumed phytoplankton.",
            "source": "literature",
            "import_type": "PARAMETER",
            "priority": 3,
            "lower_bound": 0.0,
            "upper_bound": 1.0,
            "enhanced_semantic_description": "Zooplankton assimilation efficiency (dimensionless fraction)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "g_max_D",
            "value": 0.4,
            "units": "day^-1",
            "description": "Maximum grazing rate of zooplankton on detritus.",
            "source": "model enhancement",
            "import_type": "PARAMETER",
            "priority": 1,
            "lower_bound": 0.0,
            "upper_bound": 10.0,
            "enhanced_semantic_description": "Max zooplankton grazing rate on detritus (day\u207b\u00b9)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "K_D",
            "value": 0.3,
            "units": "g C m^-3",
            "description": "Half-saturation constant for zooplankton grazing on detritus (Holling Type II).",
            "source": "model enhancement",
            "import_type": "PARAMETER",
            "priority": 1,
            "lower_bound": 1e-06,
            "upper_bound": 10.0,
            "enhanced_semantic_description": "Half-saturation detritus conc. for zooplankton grazing (g C/m\u00b3)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "beta_D",
            "value": 0.4,
            "units": "dimensionless",
            "description": "Zooplankton assimilation efficiency from consumed detritus.",
            "source": "model enhancement",
            "import_type": "PARAMETER",
            "priority": 3,
            "lower_bound": 0.0,
            "upper_bound": 1.0,
            "enhanced_semantic_description": "Zooplankton assimilation efficiency from detritus (dimensionless fraction)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "m_P",
            "value": 0.05,
            "units": "day^-1",
            "description": "Phytoplankton linear mortality rate (sinking, natural death).",
            "source": "literature",
            "import_type": "PARAMETER",
            "priority": 2,
            "lower_bound": 0.0,
            "upper_bound": 1.0,
            "enhanced_semantic_description": "Phytoplankton linear mortality rate (day\u207b\u00b9)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "alpha_shading",
            "value": 0.1,
            "units": "(g C m^-3)^-1",
            "description": "Self-shading coefficient for phytoplankton, reducing growth at high densities.",
            "source": "model enhancement",
            "import_type": "PARAMETER",
            "priority": 2,
            "lower_bound": 0.0,
            "upper_bound": 1.0,
            "enhanced_semantic_description": "Phytoplankton self-shading coefficient, creating density-dependent growth limitation (m\u00b3 g\u207b\u00b9 C)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "m_Z",
            "value": 0.1,
            "units": "(g C m^-3)^-1 day^-1",
            "description": "Zooplankton quadratic mortality rate (predation, cannibalism).",
            "source": "literature",
            "import_type": "PARAMETER",
            "priority": 2,
            "lower_bound": 0.0,
            "upper_bound": 1.0,
            "enhanced_semantic_description": "Zooplankton quadratic mortality rate (m\u00b3 g\u207b\u00b9 C day\u207b\u00b9)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "gamma",
            "value": 0.1,
            "units": "day^-1",
            "description": "Zooplankton excretion/respiration rate, contributing to nutrient regeneration.",
            "source": "literature",
            "import_type": "PARAMETER",
            "priority": 2,
            "lower_bound": 0.0,
            "upper_bound": 1.0,
            "enhanced_semantic_description": "Zooplankton excretion/respiration rate (day\u207b\u00b9)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "epsilon",
            "value": 0.2,
            "units": "day^-1",
            "description": "Remineralization rate of the detritus pool back to nutrients.",
            "source": "literature",
            "import_type": "PARAMETER",
            "priority": 3,
            "lower_bound": 0.0,
            "upper_bound": 1.0,
            "enhanced_semantic_description": "Remineralization rate of the detritus pool (day\u207b\u00b9)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "w_D",
            "value": 0.05,
            "units": "day^-1",
            "description": "Detritus sinking rate out of the mixed layer.",
            "source": "model enhancement",
            "import_type": "PARAMETER",
            "priority": 3,
            "lower_bound": 0.0,
            "upper_bound": 1.0,
            "enhanced_semantic_description": "Sinking rate of detritus out of the mixed layer (day\u207b\u00b9)",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "log_sigma_N",
            "value": -2.3,
            "units": "log(g C m^-3)",
            "description": "Log of the standard deviation for the nutrient observation error.",
            "source": "initial estimate",
            "import_type": "PARAMETER",
            "priority": 4,
            "lower_bound": null,
            "upper_bound": null,
            "enhanced_semantic_description": "Log standard deviation of nutrient observation error",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "log_sigma_P",
            "value": -2.3,
            "units": "log(g C m^-3)",
            "description": "Log of the standard deviation for the phytoplankton observation error.",
            "source": "initial estimate",
            "import_type": "PARAMETER",
            "priority": 4,
            "lower_bound": null,
            "upper_bound": null,
            "enhanced_semantic_description": "Log standard deviation of phytoplankton observation error",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        },
        {
            "parameter": "log_sigma_Z",
            "value": -2.3,
            "units": "log(g C m^-3)",
            "description": "Log of the standard deviation for the zooplankton observation error.",
            "source": "initial estimate",
            "import_type": "PARAMETER",
            "priority": 4,
            "lower_bound": null,
            "upper_bound": null,
            "enhanced_semantic_description": "Log standard deviation of zooplankton observation error",
            "updated_from_literature": false,
            "updated_fields_from_literature": []
        }
    ]
}
\end{lstlisting}
