Assessment and rationale

Update after compile error
- The previous version introduced a new required data vector (food_dat) for bottom-up resource limitation. The current data pipeline does not provide this field, causing a runtime error when constructing TMB data.
- To restore compatibility, the model now compiles without requiring food_dat. The food limitation modifier f_food defaults to 1.0 (neutral), so recruitment is unaffected by a missing food driver. The parameter K_food remains scaffolded for future use when a suitable driver is added.

1) Model fit to data
- Quantitative fit cannot be evaluated here because a residuals file was referenced but not provided with this code snapshot. The existing likelihood structure (lognormal for COTS; logit-normal for coral %) is reasonable and stabilised by sd floors. However, without residuals we cannot verify bias, autocorrelation, or variance mis-specification.
- Please provide the residuals (or their file path) so we can examine patterns such as: outbreak peak mis-timing, under/over-prediction at low/high densities, or misfit during heatwaves.

2) Alignment with PROJECT CONTEXT (NPZ: Nutrient–Phytoplankton–Zooplankton)
- The current process model represents a COTS–coral system, not an NPZ compartment model. There is no explicit nutrient or plankton state.
- Nonetheless, NPZ dynamics are ecologically linked to COTS via bottom-up control: phytoplankton/nutrient conditions influence larval survival and thus recruitment. The model currently lacks this pathway.

3) Missing or oversimplified ecological processes
- No bottom-up resource limitation on COTS recruitment (missing link from nutrient/phytoplankton availability to larval survival).
- Temperature effects on recruitment are present (Gaussian), but food/energy constraints are absent, which can cause overprediction of recruitment during low-food periods and underprediction during high-food pulses.
- Coral-side processes include space limitation, bleaching modifiers, and predation, which are reasonable for the coral dynamics component.

4) Parameter review
- Many parameters are broad and plausible. Some values labelled “literature” (e.g., T_opt_rec, T_opt_bleach, rF, rS) look reasonable as priors but do not by themselves imply structural changes.
- No evidence provided here suggests the current fecundity taper or mortality forms are inconsistent with literature. Without residuals, we avoid restructuring these components.

Chosen improvement

Approach: Resource limitation mechanism (environmental modifier of recruitment)
- Intended addition: a bottom-up resource limitation term on COTS recruitment using an exogenous food/nutrient proxy (food_dat), representing phytoplankton (chl-a) or a nutrient index.
- Mathematical form (when a driver is available): Monod saturation f_food = food / (K_food + food), evaluated at t-1 to avoid data leakage.
- Recruitment becomes: Rec_t = alpha_rec * [C_{t-1}^phi / (1 + C_{t-1}/C_sat_rec)] * f_Allee(C_{t-1}) * exp(-beta_rec (SST_{t-1}-T_opt_rec)^2) * f_food(food_{t-1}) + cotsimm_{t-1}.
- Current implementation: since food_dat is not available in the data feed, f_food is set to 1.0 (neutral). This keeps the model structure intact and compilable, while leaving K_food as a parameter for future activation.

Ecological justification
- Empirical studies associate COTS outbreaks with nutrient enrichment and phytoplankton blooms, which enhance larval survival. This bottom-up linkage is consistent with NPZ theory and improves ecological realism without overcomplicating the existing model.
- The Monod form captures diminishing returns at high resource levels and is identifiable with standardised drivers.

Data and implementation notes
- When an exogenous non-negative time series of larval food proxy (e.g., chl-a, nutrient index) becomes available, reintroduce food_dat as a DATA_VECTOR and compute f_food = food / (K_food + food) using only t-1 values to avoid data leakage.
- Until then, f_food=1.0 ensures the model matches the current data structure and avoids runtime errors.
- The change is tightly scoped: it affects only recruitment, keeps existing likelihoods intact, and avoids using current observed response values in prediction steps.

Next steps
- Provide the residuals to confirm whether this addition (once activated with a driver) reduces bias during recruitment-sensitive periods.
- If residuals still show systematic errors (e.g., phase lag), consider additional timing structure (e.g., lagged food indices or cohort delays) as a subsequent, justified enhancement.
