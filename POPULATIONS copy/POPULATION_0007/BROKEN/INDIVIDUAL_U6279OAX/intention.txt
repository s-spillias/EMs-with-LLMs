Assessment of current model vs PROJECT CONTEXT (NPZ: Nutrient–Phytoplankton–Zooplankton)

1) Fit to data
- A residuals file was referenced but not provided here, so a formal residual analysis could not be performed. Based on structure alone, the model provides mechanistic dynamics for COTS and corals with temperature, Allee effects, and consumption. Observation models are lognormal (COTS) and logit-normal (corals), which are appropriate.
- Key limitation for fit: recruitment variability is likely under-explained when bottom-up variability (phytoplankton) is omitted; the code currently fixes f_food = 1, which removes an important driver of interannual fluctuations.

2) Alignment with NPZ project context
- The present code models adult COTS, juveniles, and two coral functional groups. It does not explicitly simulate NPZ states. However, there is a scaffold for a bottom-up food limitation on recruitment via K_food.
- To align better with the NPZ context without overhauling the model, we introduce a latent resource driver (interpretable as phytoplankton/proxy “P”), linked to recruitment via a Monod function. This adds an indirect NPZ pathway (bottom-up control of COTS larvae) while retaining the existing COTS–coral structure.

3) Potentially missing or oversimplified ecological processes
- No explicit nutrient or phytoplankton dynamics (NPZ core). Recruitment currently depends on adults (stock), Allee, and temperature but lacks resource limitation.
- No interannual latent environmental variability affecting recruitment beyond SST. This can hamper fit if outbreaks are bottom-up driven by productivity pulses.
- Variable efficiencies and indirect pathways (e.g., productivity → settlement success) are absent; feeding functional response is present and reasonable.

Chosen improvement: Add a latent resource driver and Monod resource limitation on recruitment
- Approach: Resource limitation and environmental modifier via a higher-order state-space process.
- Implementation:
  - Introduce a latent AR(1) process on the log of “food” (interpreted as phytoplankton/proxy), log_food(t).
  - Map to natural scale R(t) = exp(log_food(t)).
  - Compute f_food(t) = R(t)/(K_food + R(t)) (Monod), and use f_food(t-1) to modulate recruitment at time t (avoids data leakage).
  - This augments Rec = alpha_rec * [C^phi / (1 + C/C_sat_rec)] * f_Allee * f_Trec * f_food + cotsimm.
- New parameters:
  - mu_food (log-mean), phi_food (AR coefficient 0–1), sigma_food (process SD).
  - Weak range penalties keep parameters in plausible domains without hard constraints.
- Expected effects:
  - Captures interannual variability in larval survival linked to bottom-up forcing.
  - Improves realism under NPZ framing by adding an indirect pathway (P → larval survival → recruitment).
  - Maintains identifiability by using a simple AR(1) structure with broad penalties and uses a saturating response.

Parameter review and updates
- K_food upper bound widened in parameters.json to 1000.0 to match the broad prior range used in the code (previously 100.0). This avoids artificial ceiling effects if resource is on an arbitrary scale.
- New parameters added: mu_food, phi_food, sigma_food, with suggested bounds suitable for a latent AR(1) on the log scale.
- Other parameters remain as initially specified; no literature updates provided here necessitating further structural changes.

Notes on implementation safeguards
- All prediction updates use t-1 values; the latent f_food used in recruitment is taken at t-1.
- Observation model unchanged.
- Reported outputs now include food_pred (R(t)) and f_food_series for diagnostic evaluation and future residual analyses.

Future extensions (not implemented here)
- If an external phytoplankton or nutrient driver becomes available (food_dat), replace or augment the latent resource with a data-driven term.
- Consider explicit NPZ coupling if project scope requires full nutrient–phytoplankton–zooplankton dynamics, with COTS larvae linked to Z or P via empirically based survival functions.
