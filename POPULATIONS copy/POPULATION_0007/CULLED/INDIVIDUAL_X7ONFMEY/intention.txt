Assessment of current model vs PROJECT CONTEXT (NPZ)
- Fit to data: A residuals file was requested but not provided in the current files. Without residuals or diagnostics I cannot quantitatively evaluate misfit patterns (bias, autocorrelation, heteroskedasticity). Please provide the residuals to confirm this assessment. Qualitatively, the structure can yield realistic COTS–coral dynamics, but recruitments were unconstrained by food, which often leads to overprediction of outbreaks when adult stock and temperature are favorable.
- Alignment with context: The existing model focuses on COTS–coral interactions with temperature and bleaching effects. It does not represent the NPZ (nutrient–phytoplankton–zooplankton) processes central to the PROJECT CONTEXT. In particular, the intended bottom-up linkage via K_food was disabled (f_food=1).
- Missing or oversimplified processes:
  1) Bottom-up resource limitation from phytoplankton (P) on larval survival was missing.
  2) No NPZ feedbacks (nutrient uptake, grazing, remineralization) were represented.
  3) Potential temperature effects on lower trophic levels are not modeled (kept out in this iteration to keep the change focused).
- Parameter review: Most parameters remain initial estimates without literature updates. K_food explicitly stated activation with phytoplankton, but the code forced it to a neutral effect. No other parameter updates suggest immediate structural refits.

Chosen improvement (one change): Add a minimal latent NPZ sub-model and use P as a Monod food limitation on COTS recruitment
Rationale:
- Ecological realism: COTS larval survival depends on planktonic food availability. Representing phytoplankton dynamics and linking them via a saturating Monod function f_food = P/(K_food+P) provides bottom-up control consistent with NPZ theory.
- Parismony: A simple NPZ Euler step adds resource limitation and indirect feedbacks with minimal new assumptions. We avoid altering existing COTS–coral terms and maintain prior temperature effects and consumption structure.
- Identifiability and data leakage: NPZ states are latent (no extra observations required). The linkage uses only previous-step P to avoid data leakage.

Mathematical additions (latent NPZ)
- Uptake  = muP * P * N/(K_N + N)
- Grazing = g * Z * P/(K_P + P)
- MortP   = mP * P
- MortZ   = mZ * Z
- Updates (yearly Euler):
  N_t = N + I_N + r_remin*(MortP + MortZ) - Uptake
  P_t = P + Uptake - Grazing - MortP
  Z_t = Z + e_g*Grazing - MortZ
- Recruitment modifier:
  f_food(t) = P(t-1)/(K_food + P(t-1)), applied multiplicatively with existing stock, Allee, and temperature effects.

Implementation notes
- New parameters: N0, P0, Z0, muP, K_N, g_npz, K_P_npz, mP_npz, mZ_npz, e_g, I_N, r_remin with broad bounds reflecting NPZ literature magnitudes. Smooth range_penalty keeps optimization stable.
- No changes to observation model. NPZ states are reported for diagnostics (REPORT/ADREPORT).
- No use of current time-step observations in state updates; only t-1 drivers are used, preserving the no-leakage constraint.

Next steps once residuals are available
- Examine time-structured residuals for COTS and corals. If outbreaks are still overpredicted during low-productivity periods, tighten K_food or adjust NPZ parameters (e.g., lower I_N, higher mP_npz).
- If misfit suggests missing temperature influence on P, consider adding a temperature modifier to muP (e.g., Q10 or Gaussian) as a secondary incremental improvement.
