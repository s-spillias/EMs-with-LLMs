Assessment and alignment with PROJECT CONTEXT (NPZ: Nutrient–Phytoplankton–Zooplankton)

1) Model fit to data
- Quantitative residual review: A residuals file was requested but not provided here, so I could not compute or summarize goodness-of-fit metrics (e.g., bias, heteroskedasticity, autocorrelation). Please provide the residuals to enable a targeted fit diagnosis.
- Qualitative fit expectations: The observation model choices (lognormal for COTS abundance; logit-normal for percent coral cover) are appropriate and numerically stable (with floors and smooth clamping), so they are unlikely to be the primary source of misfit unless there are strong regime shifts not captured by the process model. The process model contains reasonable non-linearities (Allee effect, Beverton–Holt taper, Type II/III functional response, bleaching temperature effects). However, additive immigration directly entering recruitment can produce overly linear increases during high-supply periods and may yield systematic positive residuals during high immigration years.

2) Relevance to the PROJECT CONTEXT (NPZ mixed-layer plankton model)
- The current model is a coral–COTS predator–prey–environment model (COTS adults and juveniles plus fast/slow coral), not an NPZ model. It does not include explicit Nutrient (N), Phytoplankton (P), or Zooplankton (Z) states, nor their canonical mass-balance fluxes (e.g., Monod uptake, grazing, recycling).
- Nevertheless, there are structural analogies: coral acts as a primary producer analog with logistic-like regrowth; COTS grazing is a consumer pressure with a saturating functional response; temperature modifies several processes. These ingredients mirror NPZ features (resource-limited growth, grazing, environmental modulation), but they are tied to benthic coral dynamics rather than plankton in the mixed layer.

3) Missing or oversimplified ecological processes (relative to NPZ and also within this model)
- No explicit nutrient pool (N) controlling producer growth (akin to Monod limitation in NPZ models).
- No explicit phytoplankton (P) or zooplankton (Z) compartments; immigration is added linearly to recruitment, rather than acting as a saturating modifier of recruitment success (i.e., resource or larval supply limitation).
- No recycling or indirect feedback from consumer losses to resource availability (typical of NPZ).
- Efficiency terms are mostly constant (qF, qS), whereas NPZ-like contexts often require variable efficiency or environmental dependence.
- Carrying capacity K_tot is static; in NPZ-like systems, resource availability can modulate effective carrying capacity or growth.

Parameter review and potential implications
- Many parameters are placeholders/initial estimates, with some guided by literature (e.g., T_opt_rec, T_opt_bleach). No explicit updates from literature affecting the structure were provided here.
- Recruitment currently includes a linear additive immigration term (+ cotsimm), which can dominate dynamics when cotsimm is large and may inflate predicted outbreaks. If recent evidence suggests larval supply modulates recruitment success rather than adding directly to it, the stock–recruitment equation should shift from additive to multiplicative modulation with a saturating (Monod-like) form.

Chosen improvement (ONE meaningful ecological change)
Approach: Resource limitation mechanism via saturating larval-supply modulation of recruitment (Monod form)

Rationale:
- In NPZ frameworks, resource limitation is central. Here, we lack explicit nutrient or phytoplankton states, but we do have an exogenous “cotsimm” time series representing larval supply/immigration. Treating it additively can yield unrealistic linearity at high supply.
- Recasting immigration as a saturating modifier of recruitment success captures a key NPZ principle: limited processing capacity (or density-dependent mating/settlement bottlenecks) prevents indefinite increases with external supply.
- This change is minimally invasive, preserves identifiability better than adding an unobserved nutrient state, and should reduce high-end bias if residuals show over-prediction during high-supply periods.

Mathematical change:
- Replace: Rec = alpha_rec * stock * f_Allee * f_Trec + cotsimm
- With: Rec = alpha_rec * stock * f_Allee * f_Trec * f_I + imm_base
  where f_I = cotsimm / (cotsimm + I_half)
  I_half is a new half-saturation constant (same units as cotsimm), imm_base is a small background recruitment/immigration independent of cotsimm.

Ecological interpretation:
- f_I implements saturating uptake/processing of an external larval-supply driver, consistent with resource limitation themes in NPZ models.
- imm_base covers low-level background inputs (e.g., baseline settlement or immigration not captured by cotsimm).

Data-leakage guard:
- All drivers used in predictions remain lagged (t-1). The modified recruitment continues to use cotsimm_dat(t-1) and sst_dat(t-1) to avoid data leakage.

Expected effects on diagnostics:
- Should reduce over-sensitivity to high cotsimm values, dampen unrealistically sharp outbreaks, and potentially reduce positive residuals in those periods.
- If residuals reveal remaining patterns tied to temperature extremes, further improvements could include variable feeding efficiency or temperature-sensitive handling time, or adding an explicit nutrient proxy for coral growth. To fully align with NPZ, a dedicated N–P–Z mass-balance model would be needed in a separate refactor.

Next steps (optional, out of scope for this single change):
- If residual diagnostics show systematic misfit around heatwaves, consider making qF, qS temperature-dependent or allowing K_tot to vary with environmental conditions.
- To align fully with the NPZ project context, implement explicit N, P, Z states and fluxes with Monod uptake and recycling pathways once appropriate data and priors are available.
