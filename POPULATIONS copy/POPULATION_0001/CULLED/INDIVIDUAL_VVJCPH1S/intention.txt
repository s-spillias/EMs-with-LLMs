Assessment

1) Fit to data
- I do not have the residuals file in this chat, so the following is based on structural inspection of the equations and common misfit patterns in COTS outbreak models.
- The current structure converts larval immigration directly into adult numbers within one year (R_imm). This tends to produce peaks that respond too quickly to immigration pulses, often leading to:
  - Outbreak onset predicted too early relative to observations (missing the empirically observed 1–3 year lag from settlement to detectable adults).
  - Boom phases that are too sharp, and sometimes decay phases that do not match observed durations if adult input is overly synchronized with immigration forcing.

2) Alignment with project context
- Strengths:
  - Includes key drivers: edible coral limitation, thermal modifiers for demography and feeding, immigration trigger, and a Type III feeding functional response.
  - Resource-modified carrying capacity (K_cots increases with edible coral) and a mate-limitation Allee effect are biologically sensible.
- Gaps versus context:
  - Outbreak timing is strongly influenced by pre-adult (cryptic) stages; direct conversion from immigration to adults within the year misses this lag and the buffering effect of juvenile stages. This can impair the model’s ability to reproduce characteristic boom-bust cycles and their duration.
  - Observations and literature indicate a delay (often ~2 years) between larval settlement and visible adult outbreaks, with substantial juvenile survival but cryptic behavior.

3) Missing or oversimplified processes
- Pre-adult stage structure and maturation delay: missing. This limits the capacity to match observed outbreak timing.
- Variable pre-adult survival and maturation rates: missing. These are critical under environmental fluctuations and can shape outbreak magnitude and persistence.

Chosen improvement

Add an explicit two-compartment pre-adult (juvenile) pipeline to introduce a realistic maturation delay from larval immigration to adult recruitment:
- Rationale:
  - Captures the empirically supported 1–3 year lag between settlement and adult outbreaks.
  - Provides a natural low-pass filter on immigration pulses, shaping the rise and fall of outbreaks without introducing data leakage.
- Implementation (discrete annual time step):
  - Compute settlers_in(t-1) from immigration at t-1 (same forcing as before), but send them into a two-stage juvenile pool (J1, J2).
  - Juveniles experience annual survival s_juv and progress between stages with probability gamma. A fraction gamma of J2 graduates to adults each year, producing adult recruitment R_adults(t).
  - The adult population update replaces direct R_imm with the delayed R_adults term.
- Expected effects:
  - Outbreak peaks occur later and are typically broader, better matching observed boom-bust cycles.
  - Immigration pulses produce more realistic temporal signatures in adults.
  - Parameterization via s_juv and gamma enables fitting the lag and smoothing implied by the residuals (once available).

Parameter adjustments

- Reinterpretation: log_alpha_imm is now the conversion from larval immigration to settlers entering the juvenile pool (not adults within the same year). Description updated accordingly.
- New parameters:
  - logit_s_juv (unitless): juvenile annual survival probability (0–1).
  - logit_gamma (unitless): annual maturation probability (0–1) per stage; with two stages, mean delay ≈ 2 / gamma years (in discrete-time approximation). Values near 1 capture ~2-year lag; lower values produce longer, broader recruitment waves.

Notes on data leakage
- All state updates at year t depend only on states and forcings from t-1 (and earlier), never on current observations. The juvenile pipeline strictly uses past forcings and past juvenile states.

Justification for added complexity
- This is a minimal higher-order state augmentation that directly addresses the key ecological mechanism controlling outbreak timing. It adds two parameters with clear biological meaning and typically improves identifiability because the lag is strongly informed by the relative phasing of immigration forcing and observed adult peaks.

Next steps (after running with residuals)
- Examine phase and amplitude of adult residuals around outbreak peaks to tune priors on gamma and s_juv.
- If peaks remain too sharp, consider a 3-compartment (Erlang-3) juvenile chain; if too diffuse, tune gamma upward or allow temperature dependence on s_juv or gamma.

Summary of code changes
- Replace direct R_imm adult input with a two-stage juvenile pipeline producing delayed adult recruitment R_adults.
- Add parameters logit_s_juv and logit_gamma, transform with inv-logit, and apply weakly-informative priors.
- Report juvenile states and adult recruitment for diagnostics.
- Update comments and parameter descriptions accordingly.
