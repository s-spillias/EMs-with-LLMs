Assessment and rationale for change

Data fit and residuals:
- Residuals file not provided in this context, so quantitative diagnostics could not be reviewed. Please share residuals to validate specifics (e.g., outbreak timing, peak magnitude, and decay tails).
- Based on model structure and typical behavior, a temperature-only larval survival term often produces smoother, less episodic recruitment pulses than observed in Great Barrier Reef COTS outbreaks.

Alignment with project context:
- Project requires reproducing boom-bust dynamics where outbreaks are often triggered by environmental pulses (notably nutrient/river runoff events) that elevate larval survival.
- The current model includes:
  - A juvenile pool with a 1+ year lag and food-dependent maturation (good for boom-bust and storage dynamics).
  - Food-limited reproduction and adult survival.
  - Coral dynamics with shared carrying capacity, bleaching mortality, and COTS predation with Type-II/III saturation.
- Missing/oversimplified: larval survival is temperature-only. Empirical work implicates nutrient/Chl-a pulses as key triggers of outbreak initiation by boosting larval food and survival. Without this, the model may mis-time or under/over-estimate peaks.

Key ecological processes potentially missing or simplified:
- Nutrient-driven larval survival (chlorophyll-a/runoff pulses) — missing.
- Potential management removals/culling — not modeled.
- Predators on COTS (fish/invertebrate predation) — not explicitly modeled.
- Coral community feedback on habitat complexity affecting juvenile refuge — not modeled.
- Environmental modulation of reproduction beyond temperature (e.g., heat stress reducing fecundity) — simplified.

Chosen improvement: Environmental modifier of larval survival via nutrient pulses
- Ecological justification: Elevated phytoplankton from terrestrial runoff increases larval feeding success and survival, creating episodic, high-amplitude recruitment that seeds outbreaks.
- Mathematical form: multiplicative temperature × nutrient effect with a saturating Hill function for nutrients and a tunable weight so the temperature-driven baseline is preserved:
  EnvLarv_t = Gaussian_Temp(T_t; Topt_larv, Tsd_larv) × [(1 - w_nutr) + w_nutr × (Chl_t^q / (K^q + Chl_t^q))]
- Benefits:
  - Enables sharp recruitment pulses when chl/runoff spikes.
  - Retains baseline reproduction under typical conditions (w_nutr < 1).
  - Maintains numerical stability and identifiability via soft bounds.

Structural and parameter updates:
- Added parameters:
  - log_K_larv_nutr: half-saturation constant for nutrient response (units of chl_dat).
  - log_q_larv_nutr: Hill exponent (q > 0), allowing Type-II/III-like shapes.
  - logit_w_larv_nutr: weight of the nutrient effect relative to baseline temperature (0–1).
- Implemented AD-safe operations and soft penalties with ecological bounds. No data leakage is introduced.

Hotfix: optionalize the nutrient driver until data are available
- The data pipeline currently does not supply chl_dat, which caused a runtime error. To restore functionality:
  - model.cpp no longer requires a DATA_VECTOR(chl_dat).
  - The nutrient saturation term is set to NutrSat = 1, making the nutrient gate neutral; EnvLarv reduces to temperature-only.
  - The three nutrient-related parameters remain with soft penalties so they are regularized and future-ready.
- To re-enable the nutrient driver later, provide a chl_dat time series (e.g., chlorophyll-a or runoff proxy) and we can switch NutrSat to use sat_hill(chl_dat, K, q).

Considerations and next steps:
- Once nutrient data are available, reactivating the nutrient gate should improve timing and magnitude of outbreak initiation.
- If nutrient data are a runoff proxy, consider fixed or estimated lags (0–2 years).
- Future potential refinements (not implemented here):
  - Management culling/removal input.
  - Predation on COTS by fishes/invertebrates as a mortality term.
  - Stage-structured juveniles (early/late) for more flexible lags.

Request:
- Please provide the residuals file and confirm the available nutrient proxy (e.g., chlorophyll-a or river discharge) used as chl_dat so we can calibrate initial parameter values and bounds if needed.
