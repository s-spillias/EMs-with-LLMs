Assessment of current model and fit
- Data leakage risk: The previous implementation mixed observed state variables into process equations beyond initialization and did not strictly use lagged values. This can bias fit and invalidate inference. The model has been rewritten to follow standard TMB conventions and to prevent data leakage by only using previous time step states and drivers in transition equations.
- Structural realism: Outbreaks of COTS are episodic and often reflect a developmental delay between larval production and adult recruitment. The earlier equations lacked an explicit lag, likely smoothing peaks and misaligning timing of booms relative to observed data.
- Residual considerations: Prior residuals (differences between observed and predicted) showed timing offsets on peaks and overly rapid decay. This suggests missing recruitment delays and over-simplified resource limitation.

Key ecological processes addressed
- Coral dynamics: Two coral groups (fast Acropora and slow massive) have logistic regrowth limited by total cover K_tot, background mortality, bleaching mortality modulated by SST via a soft threshold, and COTS predation via a Type-III functional response (captures low predation at low COTS density).
- COTS dynamics: Adult survival with baseline mortality plus starvation-linked additive mortality when food resources are low; resource-modulated carrying capacity produces a smooth ceiling on adult density.
- Recruitment and outbreaks: Introduced a one-year delayed internal recruitment pipeline. Larval production at time t-1 (driven by predation/feeding and modulated by temperature, food, and an Allee effect) recruits to adults at time t after survival (larv_surv). This delay produces more realistic boom timing.

Chosen improvement and rationale
- Approach: Indirect pathways and feedback with a delayed recruitment stage (plus environmental modifiers and resource limitation).
- Justification: A one-year developmental lag is biologically realistic for COTS and is a well-supported mechanism for episodic, pulse-like outbreaks. Coupling this with a resource-sensitive carrying capacity and thermal performance aligns with observed boom-bust cycles and the selective predation on coral guilds.

Parameter updates
- Added larv_surv (dimensionless, 0–1) to control survival of locally produced larvae into the adult class after one year. Bounds reflect biological limits; default set to 0.05 as a conservative prior consistent with high early-life mortality.
- Observation SD units for coral cover clarified to “proportion” to match the model’s 0–1 scale.

Mathematical/structural changes
- Process equations rewritten in TMB style with vector<Type> state trajectories (A_pred, S_pred, C_pred).
- Transition from t-1 to t uses only lagged states and drivers sst_dat(t-1), cotsimm_dat(t-1), eliminating leakage.
- Predation: Type-III functional response with guild-specific attack rates.
- Coral: Logistic regrowth limited by combined cover K_tot, plus background and bleaching mortalities.
- COTS: Exponential survival with mortality m_C + starvation_scale*(1 - food), addition of delayed internal recruits larv_surv*rec_potential(t-1), and exogenous immigration. Adult density is smoothly capped by a resource-modulated carrying capacity K_C*food via C_t = K_eff * (1 - exp(-input/K_eff)).
- Reproduction: Internal larval production scales with predation-derived energy intake (gamma_A*pred_A + gamma_S*pred_S), thermal performance (Gaussian around Topt_C), resource availability (Hill function of coral cover), and an Allee factor C/(Alee + C).

Notes on data usage
- No current-time observed states (variables ending with “_dat”) are used in process equations. Observations enter only through the likelihood.
- Environmental and immigration drivers are applied with a one-year lag consistent with the biological delay and to avoid leakage.

Expected effects on fit
- Improved timing of outbreak peaks due to explicit recruitment delay.
- Reduced over-shooting via smooth, resource-modulated carrying capacity.
- Better coral guild dynamics under variable SST through soft bleaching mortality.

