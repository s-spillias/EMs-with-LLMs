This model simulates the coupled dynamics of nutrients (N), phytoplankton (P), and zooplankton (Z) in the ocean mixed layer using mechanistic, process-based equations suitable for short-term forecasting. Phytoplankton growth is co-limited by nutrient availability (Monod saturation) and light (a smooth seasonal modifier), combined with a smooth Liebig-type limitation to avoid discontinuities. Zooplankton graze on phytoplankton following a sigmoidal (Holling type III) functional response that captures low-grazing refuge at low P and saturation at high P. Process-specific efficiencies are included: phytoplankton convert nutrient uptake to biomass with an efficiency, and zooplankton convert ingested phytoplankton to growth with an assimilation efficiency; non-assimilated material and mortality are remineralized back to the nutrient pool with a specified fraction. A simple external mixing supply relaxes N toward an external concentration, representing physical inputs/exports.

To ensure numerical stability and ecological plausibility, all flows are computed from previous time-step states, saturated by smooth functions, and protected by small constants to prevent division-by-zero. Parameters are softly bounded by penalties and rates are mapped through smooth, positive functions where needed. Observations (N_dat, P_dat, Z_dat) are linked to predictions (N_pred, P_pred, Z_pred) with lognormal errors and a minimum error floor, ensuring all observations contribute to the likelihood. Initial conditions are set directly from the first observations so forecasts are conditioned on observed starting states.
