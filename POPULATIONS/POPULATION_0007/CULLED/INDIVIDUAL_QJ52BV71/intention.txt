Assessment of current model vs. PROJECT CONTEXT (NPZ)

1) Fit to data
- No residuals file was provided in the current context, so I cannot compute or visualize residuals.
- However, the existing codebase is a coral–COTS–SST model, not an NPZ model. If NPZ observations (N, P, Z) were used with the current code, residuals would be dominated by structural mismatch: variables differ (COTS/corals vs. N/P/Z), scaling is incompatible, and the observation model uses logit-transformed percent cover rather than concentrations. This would yield large, structured residuals with temporal autocorrelation that cannot be resolved by parameter tuning.

2) Alignment with project context
- The existing model does not address the NPZ problem statement. It lacks nutrient limitation, phytoplankton growth, zooplankton grazing, remineralization, and vertical exchange—central to mixed-layer plankton dynamics.

3) Missing or oversimplified processes
- Nutrient-limited phytoplankton uptake (Michaelis–Menten) is absent.
- Zooplankton grazing nonlinearity (Holling II/III) is absent.
- Assimilation vs. egestion/excretion partitioning and remineralization back to nutrients is absent.
- Vertical mixing/exchange with a deep nutrient reservoir is absent.
- Appropriate observation model for positive concentrations (lognormal) is absent.

Parameter review
- All parameters were tied to COTS/coral ecology and cannot be mapped to NPZ without ad hoc reinterpretation.
- For NPZ, key parameters include: mu_max, K_N, g_max, K_P, eta_g, e_g, mP, mZ, r_remin, k_mix, N_deep, plus initial conditions and observation SDs.
- I introduced these parameters with broad, literature-informed bounds suitable for annual time steps. These are placeholders pending calibration to the dataset and inspection of residuals.

Chosen improvement and rationale
- Approach: Resource limitation mechanisms.
- Change: Implemented a canonical NPZ model with (a) saturating nutrient uptake for phytoplankton and (b) Holling Type-III grazing by zooplankton. Included remineralization and vertical mixing as key nutrient feedbacks.
- Justification: These mechanisms capture first-order controls on bloom dynamics, threshold behavior (via Type-III), and nutrient recycling, which are essential in mixed-layer NPZ systems. This is the minimal structural change that brings the model into alignment with the project context while avoiding unnecessary complexity.

Modeling considerations
- Discrete-time updates use only previous-step state predictions (no use of current observations in process equations), avoiding data leakage.
- Observation model uses lognormal errors for N, P, Z to respect positivity and multiplicative variability.
- Smooth non-negativity is enforced via a differentiable pospart function to retain AD compatibility.

Next steps for validation
- Calibrate the model to the NPZ dataset and examine residuals (magnitude, autocorrelation, bias across regimes).
- If residuals indicate systematic temperature/light effects on growth or seasonality not captured by annual time steps, consider:
  - Environmental modifiers of mu_max (e.g., Eppley temperature dependence) or a light/mixing index,
  - Seasonal forcing or sub-annual time steps,
  - Density-dependent mortality refinements or variable assimilation efficiency.
- Revisit bounds and priors as empirical constraints become available.
