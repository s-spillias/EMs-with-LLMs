Assessment and rationale for ecological improvement

1) Evaluation of model fit to data
- Residuals: A residuals file was referenced but not provided in the current context. Without the residuals, a quantitative assessment (bias, autocorrelation, heteroscedasticity) is not possible. Please provide the residuals to enable a targeted diagnostic review (e.g., whether misfit is concentrated during heatwaves, outbreaks, or at low coral cover).
- Qualitative fit expectations: Given the current structure, adult COTS dynamics depend on internal demography, SST effects on recruitment, immigration forcing, and top-down coral consumption, while corals are driven by growth/space limits, bleaching, and COTS predation. This structure can capture outbreak/bust cycles but lacks explicit bottom-up resource control that often drives larval survival and outbreak initiation.

2) Alignment with the PROJECT CONTEXT (NPZ)
- The project context is an NPZ (Nutrient–Phytoplankton–Zooplankton) mixed-layer model. The present model does not simulate N, P, or Z, and the larval food modifier (f_food) was neutralized (set to 1.0). Therefore, the current model does not address the project context directly.
- There is partial scaffolding for bottom-up control (K_food, p_food) intended to translate a food proxy into recruitment success, but with no food driver, the mechanism is inactive.

3) Missing/oversimplified ecological processes
- Bottom-up resource limitation: COTS larval survival depends strongly on planktonic food availability. This is currently missing operationally.
- Indirect feedbacks: No NPZ feedback loop exists. Consequently, SST influences recruitment only via temperature preference; it does not influence resource availability or trophic transfer (e.g., SST → P → larval survival).
- Variable efficiency: The model contains fixed conversion efficiencies for coral loss (qF, qS) but recruitment efficiency lacks a resource-dependent modulation beyond temperature.
- Environmental drivers beyond temperature: Nutrient input or mixing regimes that set the background resource level are not represented.

Chosen ecological improvement

Approach: Resource limitation mechanism through a latent NPZ submodel coupled to COTS recruitment.

Justification:
- Ecological realism: COTS larval survival and subsequent recruitment are well-known to be food-limited by phytoplankton. Incorporating P explicitly provides a mechanistic bottom-up link, consistent with the NPZ project context.
- Parismony vs. realism: Rather than replacing the entire COTS–coral model, a minimal NPZ (latent states N, P, Z) is added with a standard chemostat-like discrete-time formulation. P modulates COTS recruitment via a Monod function with existing parameters K_food and p_food. This uses the existing parameter scaffolding while providing a mechanistic driver.
- Data availability: NPZ states are treated as latent because no N, P, Z observations are currently provided. The coupling via recruitment influences the likelihood indirectly through COTS and coral fits. This avoids data leakage and honors the instruction to use only lagged drivers.
- Future extensibility: If residuals indicate systematic misfit during bloom conditions, the NPZ parameterization can be refined (e.g., add temperature-dependent phytoplankton growth).

Summary of structural change
- Added latent NPZ states with Euler yearly updates:
  P growth: μP * N/(KN+N) * P
  Z grazing: gZ * P/(KP+P) * Z
  Losses: mP*P, mZ*Z
  Zooplankton production: eZ * (gZ * P/(KP+P) * Z)
  Nutrient balance: N increases with external input (IN) and recycling from mortality and non-assimilated grazing; decreases with phytoplankton growth (uptake).
- Recruitment modifier:
  f_food = (P / (K_food + P))^p_food (uses P at t−1)
- No current-time response variables are used in predictions; only t−1 states and exogenous drivers (SST, immigration) are used.

Parameter review and bounds
- K_food and p_food were placeholders; they are now activated to scale the effect of phytoplankton on recruitment.
- Added NPZ parameters with conservative bounds to keep dynamics stable:
  N0, P0, Z0 ∈ [0, 100] (scaled biomass/conc units)
  μP ∈ [0, 5] yr^-1; KN ∈ [0.001, 10]
  gZ ∈ [0, 5] yr^-1; KP ∈ [0.001, 10]
  mP, mZ ∈ [0, 2] yr^-1; eZ ∈ [0, 1]
  IN ∈ [0, 10] (external N supply per year)
- These ranges are weakly enforced via smooth penalties (not hard constraints), preserving identifiability and AD friendliness.

Expected effects on fit
- If observed COTS outbreaks correlate with periods of high phytoplankton (or residuals suggest underprediction of recruitment during presumed blooms), the NPZ coupling should reduce bias and temporal autocorrelation in residuals for COTS and, indirectly, coral cover trajectories.
- If residuals later show insensitivity, consider adding temperature dependence to μP or seasonal mixing proxies for IN.

Notes and next steps
- Please provide the residuals file to verify whether this improvement targets the dominant sources of misfit and to tune NPZ parameter priors if necessary.
- If NPZ observations (e.g., chlorophyll-a) become available, adding an observation model for P would further constrain the latent NPZ states.
