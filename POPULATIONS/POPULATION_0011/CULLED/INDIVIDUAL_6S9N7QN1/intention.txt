Purpose
Simulate the coupled dynamics of nutrient (N), phytoplankton (P), and zooplankton (Z) concentrations in the ocean mixed layer to understand and predict plankton trophic interactions and nutrient cycling over time.

Ecological functioning
- Phytoplankton growth is limited by multiple resources and conditions:
  - Nutrient limitation follows a saturating Monod function of N.
  - Self-shading introduces a crowding/light-like limitation that reduces growth as P increases.
  - An environmental seasonal modifier (smooth sinusoid mapped through a logistic function) scales growth rates with changing conditions (e.g., light/temperature seasonality).
  - A growth efficiency converts nutrient uptake into phytoplankton biomass, with the remainder potentially remineralized.
- Zooplankton grazing on phytoplankton:
  - Uses a Holling type-III functional response to capture low-consumption at low prey and saturation at high prey.
  - Includes a smooth prey “threshold/refuge” using a logistic soft-threshold so grazing declines as P falls below a threshold.
  - Assimilation efficiency allocates ingested carbon to zooplankton biomass; unassimilated ingestion is egested/remineralized to nutrients.
- Mortality and recycling:
  - Both phytoplankton and zooplankton experience natural mortality, with zooplankton including quadratic (density-dependent) losses representing higher predators or disease.
  - Fractions of P and Z mortality, and phytoplankton growth inefficiency, are recycled to the nutrient pool.
- Physical supply:
  - Vertical mixing relaxes N toward an external pool (deep/marginal nutrient concentration) at a mixing rate, closing the nutrient budget.
- Observation model:
  - Observations of N, P, Z are strictly positive and modeled with lognormal errors with a minimum standard deviation for numerical robustness.

Numerical and statistical care
- Time stepping uses only previous predicted states (no data leakage), initialized from the first observations.
- Small constants and softplus are used to avoid division by zero and negative states via smooth floors.
- Smooth penalties (not hard constraints) discourage parameters from leaving biologically plausible ranges.
- Lognormal likelihood is used for strictly positive state variables, with a minimum observation SD.

Intended use
Calibrate the model against N, P, Z time series to infer rates and efficiencies and to forecast system trajectories under varying initial conditions and environmental forcing.
