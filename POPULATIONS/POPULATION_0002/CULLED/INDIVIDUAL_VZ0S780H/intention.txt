Assessment and rationale (COTS boom–bust model)

Note on residuals:
- The residuals file was referenced but not included in this chat. Quantitative fit evaluation (patterns, autocorrelation, peak/timing bias) cannot be performed here. The assessment below is structural, based on model equations and parameterization. Please share the residuals to refine diagnostics (e.g., whether peaks are too smooth, late/early, too low/high, or busts are too slow).

1) Fit to data (structural assessment)
- The process is forward-only with no data leakage; observation models are appropriate (lognormal for COTS abundance; logit-normal for percent cover). SD floors are in place for stability.
- The model can generate outbreaks via:
  - A juvenile stage with maturation delay (mJ) and juvenile survival (sJ).
  - A rectified SST anomaly pulse (Pulse) augmenting larval success, on top of Gaussian larval performance around Topt_larv.
  - Food limitation and temperature-driven adult mortality to sharpen busts.
- These features are conducive to producing episodic booms followed by busts; however, the strength and timing of peaks depend on how sharply resource use shifts as coral community composition changes. With a fixed diet preference (pref_fast_logit), predation pressure distribution between fast vs slow coral may be too rigid, potentially dulling outbreak peaks or extending them unrealistically if the model cannot reallocate feeding when Acropora declines.

2) Alignment with project context
- Context emphasis: triggers and sustenance of outbreaks, selective predation on coral functional groups, and boom–bust cycle realism.
- Strengths present: temperature-modified fecundity via pulse, Allee effect, stage structure, food-dependent adult mortality, saturating predation.
- Potential gap: fixed diet preference does not capture adaptive prey switching, a key mechanism for both rapid escalation (when Acropora is abundant) and continued, but reduced, pressure on slow corals as Acropora declines, which influences the duration and magnitude of busts.

3) Potential missing/oversimplified ecological processes
- Adaptive foraging (prey switching) with relative availability: likely important for timing, coral community effects, and the persistence phase of outbreaks.
- Settlement dependence on habitat state (e.g., CCA vs macroalgae) is not represented; currently “Food” mediates reproduction but may not fully capture settlement-stage substrate feedbacks.
- Environmental memory (e.g., multi-month thermal metrics) is partially approximated via anomaly pulses; could be refined, but current pulse + Gaussian is a reasonable first-order representation.
- Management removals not modeled (if relevant to data).
- Immigration forcing is present; density dependence is on adult density (Ricker term); an alternative is adding dd at juvenile/settlement stage, but that increases complexity.

Chosen improvement (one meaningful change):
Adaptive diet preference (prey switching) that depends on the relative availability of fast vs slow coral.
- Ecological reasoning: COTS are known to prefer Acropora but can switch as availability changes. A dynamic preference intensifies predation on fast coral when it is abundant, sharpening the outbreak rise, then shifts some pressure toward slow coral as Acropora declines, aiding the bust and shaping coral community trajectories.
- Mathematical implementation:
  - Let p_fast,t = inv_logit(pref_fast_logit + pref_fast_sens * log((F_t + ε)/(S_t + ε))).
  - Modify predation effort and food availability:
    - cons_fast_raw = (alpha_fast * p_fast,t) * C_t * sat_hill(F_t, K_pred_fast, q_pred)
    - cons_slow_raw = (alpha_slow * (1 - p_fast,t)) * C_t * sat_hill(S_t, K_pred_slow, q_pred)
  - Food term used in reproduction becomes Food_t = [p_fast,t * F_t + (1 - p_fast,t) * S_t] / (K_food + [same numerator]).
- Parameter added: pref_fast_sens (sensitivity of logit preference to log(F/S)). This keeps the base preference pref_fast_logit interpretable and allows data to inform the degree of switching. Bounds [-5, 5] suggested to avoid extreme non-identifiability.
- Expected effects on fit:
  - Sharper, more realistic outbreak peaks when Acropora is available.
  - More realistic transition to bust as Acropora depletes and feeding reallocates.
  - Improved timing alignment if residuals show late or prolonged peaks.
  - Food-mediated fecundity responds to the same adaptive preference, strengthening resource–reproduction linkage.

Review of current parameter values (high level)
- log_r_fast > log_r_slow (as desired); ranges appear sensible.
- Mortality, bleaching, and thermal performance parameters have plausible bounds and interpretations.
- Juvenile stage (sJ, mJ) supports realistic development delays; priors/bounds look reasonable.
- Pulse parameters (A, tau, gamma) allow a broad class of episodic responses.
- Many parameters are “initial estimate”; without residuals we cannot prioritize re-centering or tightening bounds, but the adaptive preference addition supplies a critical missing mechanism with limited additional complexity and interpretable physiology.
- No structural change to observation models required.

Notes/assumptions and next steps
- This change is conservative: 1 new parameter and reweights existing predation/food terms.
- After running with the residuals, check:
  - Peak timing and magnitude biases.
  - Coral community trajectories (fast vs slow) for ecological plausibility.
  - Identifiability: if pref_fast_sens trends to zero, the model supports no switching; if large, consider narrowing bounds or adding weak priors/penalties (a small soft box penalty is included).
- If residuals show multi-year environmental memory, consider replacing SST anomaly pulse with a windowed or DHW-like metric in a future iteration.

Implementation summary
- Added parameter pref_fast_sens and adaptive preference in model.cpp.
- Predation effort and Food now use time-varying p_fast,t derived from current state predictions (not observations).
- Added reporting of the preference time series for diagnostics (pref_fast_series).
