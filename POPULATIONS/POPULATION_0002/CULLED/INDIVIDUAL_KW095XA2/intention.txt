ASSESSMENT AND RATIONALE

A) Fit to data
- I did not find the residuals file in the provided context. Please supply it so I can quantify fit quality (bias, autocorrelation, heteroskedasticity).
- Based on model structure, expected residual signatures if fit is imperfect:
  - COTS: under-prediction of peaks and over-prediction of non-outbreak years (lack of sharp recruitment pulses).
  - Coral: timing errors where fast coral declines lag or lead observed outbreak peaks; slow coral may be over-smoothed.
  - Residual autocorrelation around outbreak onset/decline due to missed threshold-like dynamics.

B) Alignment with project context
- The model includes key ingredients for boom-bust cycles:
  - Strong nonlinearity and delayed density dependence via Ricker term (exp(-beta*C_t)).
  - Reproduction Allee gate (A_gate) and food dependence through coral cover.
  - Temperature-modulated processes (larval survival and coral growth).
  - Predation functional response with Hill-type saturation (q_pred).
- However, many COTS outbreak studies show that recruitment pulses are tied to episodic environmental anomalies (e.g., warm stratified waters and/or flood-plume induced productivity). With only a smooth Gaussian temperature effect, pulses may be too diffuse to reproduce sharp outbreak onsets.

C) Key ecological processes possibly missing or oversimplified
- Outbreak trigger: episodic favorable conditions for larval survival (e.g., positive SST anomalies and productivity events). Currently only a smooth Gaussian of absolute SST is used, which may miss threshold-like recruitment pulses.
- Maturation delay: real systems often have 2–3 years to maturity; model uses a single-year lag. This can be revisited later if residuals show phase/timing errors.
- Juvenile refuge and stage structure: important for persistence and lag effects but would add notable complexity.
- Hydrodynamic connectivity: partially represented by cotsimm_dat and a scaling parameter, which is good.

D) Parameter review
- Topt_larv has updated bounds from literature; the Gaussian EnvLarv remains ecologically valid.
- Other parameters remain initial/literature-consistent. No immediate structural inconsistencies detected from updated values.

SELECTED ECOLOGICAL IMPROVEMENT

Goal: Introduce an episodic environmental trigger on larval survival to produce sharp, realistic recruitment pulses that initiate outbreaks.

Approach: Add a smooth, thresholded SST anomaly pulse multiplier on larval production.
- Compute SST anomaly as T_anom(t) = sst_dat(t) - mean(sst_dat).
- Pulse term: Pulse_t = 1 + A_pulse * (sigmoid((T_anom(t) - T_thresh_pulse)/tau_pulse) - sigmoid((-T_thresh_pulse)/tau_pulse))
  - A_pulse ≥ 0 sets the strength of positive anomalies; subtracting the baseline at zero anomaly centers the average effect near 1, allowing cool anomalies to modestly reduce survival and warm anomalies to enhance it.
  - tau_pulse controls smoothness around the threshold; T_thresh_pulse determines the onset anomaly level.
- Apply Pulse_t multiplicatively to larval production L_t (before maturation) and add immigration as before:
  L_t = [phi * C_t * Food_t * EnvLarv_t * exp(-beta*C_t) * A_gate_t] * Pulse_t + k_imm * cotsimm_dat(t)

Why this helps
- Captures outbreak initiation via threshold-like environmental windows observed in COTS systems.
- Retains existing ecological realism (Allee, density dependence, food limitation).
- Adds only three interpretable parameters with reasonable priors/bounds.
- Avoids data leakage—only uses current-year forcing (SST), not current observations.

VALIDATION PLAN AFTER CHANGE
- Examine residuals for: reduction of peak under-prediction and outbreak onset timing errors; reduced residual autocorrelation around peaks.
- Profile new parameters (A_pulse, T_thresh_pulse, tau_pulse) for identifiability and plausible ranges.
- Check posterior predictive distributions for boom-bust amplitude and duration.

REQUEST
- Please provide the residuals file so I can quantify improvements and diagnose any remaining patterns (e.g., systematic timing shifts that might motivate adding a longer maturation delay or stage structure).

ADDITIONAL MODEL SETUP CORRECTION (DATA LEAKAGE)
- To eliminate data leakage in the state dynamics, initial conditions are no longer set from observations at t=0.
- Added estimable initial-state parameters:
  - log_cots_init: initial adult COTS density (>0 via exponentiation).
  - logit_fast_init, logit_slow_init: initial fractions of K_tot for fast/slow coral (mapped via invlogit).
- Predicted states at t=0 now come solely from these parameters, while observations at t=0 contribute only via the likelihood. This preserves identifiability without leaking observed values into the process model.
