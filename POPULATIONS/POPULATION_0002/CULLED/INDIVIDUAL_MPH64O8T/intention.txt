Assessment of current model and rationale for change

1) Fit to data (based on structure; residuals file not available in chat)
- The model structure is statistically coherent and avoids data leakage by using only lagged state predictions to compute current predictions; observations enter exclusively via the likelihood.
- Observation models: lognormal for COTS and logit-normal for coral cover with SD floors are appropriate and numerically stable.
- Without the residuals file, I cannot quantify lack-of-fit. However, common misfit patterns in COTS-coral systems include:
  - Timing lag: Peaks in adults occur earlier or later than observed due to overly direct coupling between reproduction and food/temperature.
  - Magnitude bias: Outbreak peaks too high or too low when reproduction is too sensitive/insensitive to food.
  - Duration mismatch: Busts last too long or too short if maturation and survivorship do not vary enough with resource composition.

2) Alignment with the PROJECT CONTEXT
- Strengths:
  - Includes a juvenile storage pool that naturally introduces delays and can produce episodic booms.
  - Reproduction includes an Allee-type gate and density dependence (Ricker form) which supports boom-bust dynamics.
  - Environmental modifiers (thermal performance for larvae and corals; bleaching mortality) affect both recruitment and coral substrate.
  - COTS predation on fast vs slow corals is explicit with saturating functional responses.
- Limitations relevant to outbreak timing, magnitude, and duration:
  - Diet preference is fixed (pref_fast), so the food index that controls fecundity, maturation, and food-stress mortality does not respond to changing coral composition. Empirically, COTS show selective predation and context-dependent switching toward Acropora when it is abundant. A static preference can distort the timing and amplitude of booms following increases in fast coral cover.
  - Total predation capacity per adult is not capped jointly across prey (the model caps each prey separately). While this might be acceptable, it can overestimate total area cleared when both prey are abundant.
  - Additional drivers noted in literature (e.g., nutrient/runoff pulses boosting larval survival) are not represented because no runoff/chl-a data stream is provided.

3) Potentially missing or oversimplified ecological processes
- Dynamic diet preference (prey switching) toward the more abundant coral type (especially Acropora).
- Joint consumption cap across prey (shared handling-time budget).
- Runoff/nutrient effects on larval survival (requires external data not present here).
- Predator control on COTS (uncertain strength; not included).
- Temperature effects on juvenile survival/maturation distinct from larvae/coral (additional complexity, uncertain benefit).

Chosen single improvement: dynamic diet preference (prey switching) in the food index
- Approach type: Variable efficiency terms and indirect feedback mechanism.
- Ecological reasoning: COTS are known to preferentially consume Acropora but can switch consumption based on relative availability. As outbreaks deplete fast coral, effective preference should shift, reducing fecundity benefits from the food index and increasing food-stress mortality, thereby shortening outbreak duration and improving timing. Conversely, when fast coral rebounds, preference should strengthen, enabling renewed booms. This feedback can better capture characteristic boom-bust cycles.
- Mathematical change: Replace the static pref_fast weight used in the food index with a dynamic, composition-sensitive preference:
    p_fast_t = invlogit(pref_fast_logit + gamma_pref * log((F_t + eps)/(S_t + eps)))
    Food_t = (p_fast_t * F_t + (1 - p_fast_t) * S_t) / (K_food + p_fast_t * F_t + (1 - p_fast_t) * S_t)
  where gamma_pref ≥ 0 controls how strongly preference shifts toward the more abundant coral type. This modifies fecundity, maturation, and adult food-stress mortality through Food_t, without using any observed current-time data (only predicted states at t).

Parameter updates
- Added parameter: log_gamma_pref (log-scale for gamma_pref ≥ 0).
  Ecological justification: Controls the strength of prey-switching. Small values approximate fixed preference; larger values increase responsiveness to relative availability. Bounds ensure biological plausibility and numerical stability.
  Suggested bounds (log scale): lower_bound -9.2 (~gamma ≈ 1e-4), upper_bound 1.6 (~gamma ≈ 5).

Why this single change?
- It adds minimal complexity (one parameter), leverages existing state variables, and directly targets outbreak timing and duration via changes in fecundity, maturation, and survival through the food index. It maintains parsimony relative to alternatives like additional environmental datasets or full joint handling-time constraints, which would require more parameters and re-scaling of existing predation terms.

Notes on alternatives not implemented in this step
- A joint consumption cap across prey would likely further improve realism but requires revisiting alpha_fast/alpha_slow scaling or adding a new alpha_total parameter and an allocation rule; this is a larger structural change.
- Runoff-driven larval survival could be added if a suitable environmental proxy is available.

Data leakage safeguard
- The new preference uses only predicted fast/slow coral states from the previous step (F_t, S_t), preserving the current model’s no-leakage design.

Testing recommendation
- After fitting, inspect residuals for:
  - Improved alignment of outbreak onset relative to fast-coral rebounds.
  - Reduced bias in peak adult densities and a more realistic decline phase when Acropora is depleted.
  - Coral composition trajectories that reflect switching behavior (reduced pressure on slow corals when Acropora is scarce).
